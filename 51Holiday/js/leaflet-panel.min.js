/*
 * 
 * Author: Hu Chia Wei
 * Date: 2016.3.10
 * Email: Kenneth.hu@hotmail.com
 */
(function(){L.Control.PanelLayers=L.Control.Layers.extend({options:{collapsed:!1,position:"topright",autoZIndex:!0},initialize:function(e,t,a){L.setOptions(this,a),this._layers={},this._groups={},this._layersActives=[],this._lastZIndex=0,this._handlingClick=!1,this._baseLayersCtrl=[];var r,i;for(r in e)if(e[r].group&&e[r].layers)for(i in e[r].layers)this._addLayer(e[r].layers[i],!1,e[r].group);else this._addLayer(e[r],!1);for(r in t){var l=!0;if(t[r].group&&t[r].layers)for(i in t[r].layers)t[r].hasOwnProperty("marker")&&t[r].marker.hasOwnProperty("active")&&(l=t[r].marker.active),this._addLayer(t[r].layers[i],!0,t[r].group,l);else t[r].hasOwnProperty("marker")&&t[r].marker.hasOwnProperty("active")&&(l=t[r].marker.active),this._addLayer(t[r],!0,t[r].group,l)}},getfilter:function(e,t){for(i in t)if(e==t[i].layer)return t[i].filter;return null},onAdd:function(e){for(var t in this._layersActives)e.addLayer(this._layersActives[t]);return L.Control.Layers.prototype.onAdd.call(this,e),this._container},addBaseLayer:function(e,t,a){return e.name=t||e.name||"",this._addLayer(e,!1,a),this._updateLayers(),this},addOverlay:function(e,t,a){return e.name=t||e.name||"",this._addLayer(e,!0,a),this._updateLayers(),this},_addLayer:function(e,t,a,r){var i,l,n=this._instanceLayer(e.layer),s=L.stamp(n);e.active&&this._layersActives.push(n),e.marker&&e.marker.control&&(i=e.marker.control),e.marker&&e.marker.displayname&&(l=e.marker.displayname),this._layers[s]={layer:n,name:e.name,icon:e.icon,overlay:t,group:a,markertype:i,displayname:l,filter:e.filter,subcontrols:[],subfiltercontrols:[],IsActiveMarker:r},this.options.autoZIndex&&n.setZIndex&&(this._lastZIndex++,n.setZIndex(this._lastZIndex))},_instanceLayer:function(e){return e instanceof L.Class?e:e.type&&e.args?this._getPath(L,e.type).apply(window,e.args):void 0},_createItem:function(e){var t,a,r,i="leaflet-panel-layers";r=this._map.hasLayer(e.layer);var l=L.stamp(e.layer);if(e.overlay?(t=L.DomUtil.create("label",i+"-layer"),a=document.createElement("input"),a.type="checkbox",a.className="leaflet-control-layers-selector",a.defaultChecked=r,L.DomEvent.on(a,"click",this._onInputClick,this)):(t=L.DomUtil.create("label",i+"-item"),a=this._createRadioElement("leaflet-base-layers",r),a.id="base-layer"+l,L.DomEvent.on(a,"click",this._onbaselayersInputClick,this),this._baseLayersCtrl.push({id:a.id,type:"radio"})),a.setAttribute("data-layerId",l),a.layerId=L.stamp(e.layer),t.appendChild(a),e.icon){var n=L.DomUtil.create("i",i+"-icon");n.innerHTML=e.icon||"",t.appendChild(n)}var s=document.createElement("span");return s.innerHTML=" "+e.name,t.appendChild(s),t},_createMarkerItem:function(e,t){var a,r,i="leaflet-panel-layers",l=this;a=L.DomUtil.create("label",i+"-item"),r=document.createElement("span"),r.className="leaflet-control-layers-selector";document.createTextNode(" "+e.feature.properties.name);if(a.innerHTML=" "+e.feature.properties.name,a.setAttribute("data-lat",e._latlng.lat),a.setAttribute("data-lon",e._latlng.lng),a.setAttribute("data-layerid",t),a.setAttribute("data-markerid",e._leaflet_id),a.layerId=L.stamp(e),a.id="label"+a.layerId,this._layers[t].subcontrols.push({id:a.id,type:"label"}),L.DomEvent.addListener(a,"click",L.DomEvent.stopPropagation).addListener(a,"click",L.DomEvent.preventDefault).addListener(a,"click",this._onMarkerClick,this),L.DomEvent.on(a,"mouseover",function(e){l._onMarkerMouseOver(e)},this).on(a,"mouseout",function(e){l._onMarkerMouseOut(e)},this),a.appendChild(r),e.icon){var n=L.DomUtil.create("i",i+"-icon");n.innerHTML=e.icon||"",a.appendChild(n)}return a},_createMarkerDropDown:function(e){var t,a,r,i,l="leaflet-panel-layers",n=e.layer,s=e.name,o=L.stamp(n);e.displayname&&(s=e.displayname),r=L.DomUtil.create("legend",l+"-grouplabel"),i=document.createElement("span"),i.innerHTML=" "+s,r.id=s.toLowerCase(),r.appendChild(i),t=L.DomUtil.create("select",l+"-item"),t.id="dropdown"+o,this._layers[o].subcontrols.push({id:t.id,type:"dropdown"});for(var d in n._layers)if(n._layers[d].feature){var a=document.createElement("option");a.value=n._layers[d].feature.properties.name,a.text=n._layers[d].feature.properties.name,a.setAttribute("data-lat",n._layers[d]._latlng.lat),a.setAttribute("data-lon",n._layers[d]._latlng.lng),t.appendChild(a)}return L.DomEvent.addListener(t,"change",L.DomEvent.stopPropagation).addListener(t,"change",L.DomEvent.preventDefault).addListener(t,"change",this._onMarkerChange,this),r.appendChild(t),r},_createMarkerAccordion:function(e){var t,a,r=(e.name,e.name),i=e.layer;t=L.DomUtil.create("ul","leaflet-panel-layers-accordion");var l=L.stamp(i);e.displayname&&(r=e.displayname),t.id="accordion"+l,this._layers[l].subcontrols.push({id:t.id,type:"accordion"}),a=document.createElement("li"),a.innerHTML=" "+r,L.DomEvent.addListener(a,"click",L.DomEvent.stopPropagation).addListener(a,"click",L.DomEvent.preventDefault).addListener(a,"click",this._onAccordionClick,this),t.appendChild(a),ul=L.DomUtil.create("ul");for(var n in i._layers)if(i._layers[n].feature&&i._layers[n].feature.properties){var a=document.createElement("li"),s=document.createElement("a");s.innerHTML=i._layers[n].feature.properties.name,s.setAttribute("href","#"),a.setAttribute("data-lat",i._layers[n]._latlng.lat),a.setAttribute("data-lon",i._layers[n]._latlng.lng),s.setAttribute("data-lat",i._layers[n]._latlng.lat),s.setAttribute("data-lon",i._layers[n]._latlng.lng),s.id=t.id+"_"+n,this._layers[l].subcontrols.push({id:s.id,type:"accordion_li"}),L.DomEvent.addListener(s,"click",L.DomEvent.stopPropagation).addListener(s,"click",L.DomEvent.preventDefault).addListener(s,"click",this._onMarkerClick,this),a.appendChild(s),ul.appendChild(a)}return t.appendChild(ul),t},_createMarkerAccordionCheckbox:function(e){var t,a,r,i=(e.name,e.name),l=e.layer;t=L.DomUtil.create("ul","leaflet-panel-layers-accordion");var n=L.stamp(l);e.displayname&&(i=e.displayname),t.id="accordion"+n,this._layers[n].subcontrols.push({id:t.id,type:"accordion"}),r=document.createElement("li"),r.innerHTML=" "+i,L.DomEvent.addListener(r,"click",L.DomEvent.stopPropagation).addListener(r,"click",L.DomEvent.preventDefault).addListener(r,"click",this._onAccordionClick,this),t.appendChild(r),ul=L.DomUtil.create("ul");for(var s in l._layers)if(l._layers[s].feature&&l._layers[s].feature.properties){var r=document.createElement("li");a=document.createElement("input"),a.type="checkbox",a.className="leaflet-control-layers-selector",a.layerId=n,a.setAttribute("data-layerId",n),a.setAttribute("data-markername",l._layers[s].feature.properties.name),a.setAttribute("data-markerid",l._layers[s]._leaflet_id),L.DomEvent.on(a,"click",this._onAccordionCheckBoxClick,this),a.defaultChecked=!0;var o=document.createElement("a");o.innerHTML=l._layers[s].feature.properties.name,o.setAttribute("href","#"),o.setAttribute("onclick","map.panTo( new L.LatLng("+l._layers[s]._latlng.lat+", "+l._layers[s]._latlng.lng+" ) );return true;"),r.setAttribute("data-lat",l._layers[s]._latlng.lat),r.setAttribute("data-lon",l._layers[s]._latlng.lng),o.id=t.id+"_"+s,this._layers[n].subcontrols.push({id:o.id,type:"accordion_li"}),r.appendChild(a),r.appendChild(o),ul.appendChild(r)}return t.appendChild(ul),t},_onMarkerMouseOver:function(e){var t=(e.currentTarget,e.currentTarget.getAttribute("data-layerid")),a=this._layers[t],r=e.currentTarget.getAttribute("data-markerid");for(ml in this._map._layers){var i=this._map._layers[ml];i.feature&&i.options.title.toLowerCase()==a.name.toLowerCase()&&i._leaflet_id==r&&(i._icon.src="images/select-marker.png",i._icon.style.cursor="#08f")}},_onMarkerMouseOut:function(e){var t=(e.currentTarget,e.currentTarget.getAttribute("data-layerid")),a=this._layers[t],r=e.currentTarget.getAttribute("data-markerid");for(ml in this._map._layers){var i=this._map._layers[ml];i.feature&&i.options.title.toLowerCase()==a.name.toLowerCase()&&i._leaflet_id==r&&(i._icon.src="http://cdn.leafletjs.com/leaflet/v0.7.7/images/marker-icon.png",i._icon.style.backgroundColor="")}},_onAccordionCheckBoxClick:function(e){var t=e.currentTarget,a=e.currentTarget.getAttribute("data-layerid"),r=this._layers[a],i=(e.currentTarget.getAttribute("data-markername"),e.currentTarget.getAttribute("data-markerid"));for(ml in this._map._layers){var l=this._map._layers[ml];l.feature&&l.options.title.toLowerCase()==r.name.toLowerCase()&&l._leaflet_id==i&&(t.checked?l._icon.style.display="":l._icon.style.display="none")}},_onAccordionClick:function(e){var t=e.currentTarget;$(t).next().slideToggle(300)},_createFilterDropDown:function(e,t,a){var r,i,l,n,s="leaflet-panel-layers";l=L.DomUtil.create("legend",s+"-grouplabel"),n=document.createElement("span"),n.innerHTML=" "+t,l.id=a.toLowerCase(),l.appendChild(n),r=L.DomUtil.create("select",s+"-item"),r.setAttribute("data-layerId",e._leaflet_id);var o=[];for(var d in e._layers)if(e._layers[d].feature&&e._layers[d].feature.properties){var c=e._layers[d].feature.properties[t];-1==o.indexOf(c)&&o.push(e._layers[d].feature.properties[t]),r.setAttribute("data-layer",e._layers[d]._latlng.lat)}r.id="Filter"+t+e._leaflet_id,r.setAttribute("data-field",t);var p=L.stamp(e);this._layers[p].subfiltercontrols.push({id:r.id,type:"dropdown",field:t});var u=document.createElement("option");u.value="All",u.text="All",u.id=t,r.appendChild(u);for(var d in o){var i=document.createElement("option");i.value=o[d],i.text=o[d],i.id=t,r.appendChild(i)}return l.appendChild(r),L.DomEvent.addListener(r,"change",L.DomEvent.stopPropagation).addListener(r,"change",L.DomEvent.preventDefault).addListener(r,"change",this._onDropDownFilter,this),l},_createFilterCheckBox:function(e,t,a){var r,i,l,n,s="leaflet-panel-layers";r=L.DomUtil.create("legend",s+"-grouplabel"),i=document.createElement("span"),i.innerHTML=" "+t,r.appendChild(i);var o=[];for(var d in e._layers)if(e._layers[d].feature){var c=e._layers[d].feature.properties[t];-1==o.indexOf(c)&&o.push(e._layers[d].feature.properties[t])}var p=L.stamp(e);r.id="Filter"+t+p;for(var d in o){n=L.DomUtil.create("label",s+"-item"),l=document.createElement("input"),l.type="checkbox",l.className="leaflet-control-layers-selector",l.defaultChecked="true";var i=document.createElement("span");i.innerHTML=" "+o[d],l.id="Filter"+t+"Ctrl"+d,l.value=o[d],l.setAttribute("data-layerId",L.stamp(e)),l.setAttribute("data-field",t),l.setAttribute("data-layername",a),this._layers[p].subfiltercontrols.push({id:l.id,type:"checkbox",field:t}),n.appendChild(l),n.appendChild(i),L.DomEvent.addListener(l,"change",L.DomEvent.stopPropagation).addListener(l,"change",L.DomEvent.preventDefault).addListener(l,"change",this._onCheckBoxFilter,this),r.appendChild(n)}return r},_createFilterRadio:function(e,t){var a,r,i,l,n="leaflet-panel-layers";a=L.DomUtil.create("legend",n+"-grouplabel"),r=document.createElement("span"),r.innerHTML=" "+t,a.appendChild(r),a.setAttribute("data-layerId",L.stamp(e));var s=[];for(var o in e._layers)if(e._layers[o].feature&&e._layers[o].feature.properties){var d=e._layers[o].feature.properties[t];-1==s.indexOf(d)&&s.push(e._layers[o].feature.properties[t])}a.id="FilterRadio"+t;var c=L.stamp(e);this._layers[c].subfiltercontrols.push({id:a.id,type:"radio",field:t}),l=L.DomUtil.create("label",n+"-item"),i=this._createRadioElement(a.id+"option",!0),i.setAttribute("data-layerId",L.stamp(e));var r=document.createElement("span");r.innerHTML=" All",i.id=t+"Ctrl",i.value="All",l.appendChild(i),l.appendChild(r),a.appendChild(l);for(var o in s){l=L.DomUtil.create("label",n+"-item"),i=this._createRadioElement(a.id+"option",!1);var r=document.createElement("span");r.innerHTML=" "+s[o],i.id=t+"Ctrl"+o,i.value=s[o],l.appendChild(i),l.appendChild(r),this._layers[c].subfiltercontrols.push({id:i.id,type:"radio",field:t}),a.appendChild(l)}return L.DomEvent.addListener(a,"change",L.DomEvent.stopPropagation).addListener(a,"change",L.DomEvent.preventDefault).addListener(a,"change",this._onRadioFilter,this),a},_createFilterAccordionCheckBox:function(e,t,a){var r,i,l,n="leaflet-panel-layers";r=L.DomUtil.create("ul","leaflet-panel-layers-accordion");var s=L.stamp(e);r.id="accordion"+s,l=document.createElement("li"),l.innerHTML=" "+t,L.DomEvent.addListener(l,"click",L.DomEvent.stopPropagation).addListener(l,"click",L.DomEvent.preventDefault).addListener(l,"click",this._onAccordionClick,this),r.appendChild(l),ul=L.DomUtil.create("ul");var o=[];for(var d in e._layers)if(e._layers[d].feature&&e._layers[d].feature.properties){var c=e._layers[d].feature.properties[t];-1==o.indexOf(c)&&o.push(e._layers[d].feature.properties[t])}for(var d in o){var l=document.createElement("li");label=L.DomUtil.create("label",n+"-item"),i=document.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked="true";var p=document.createElement("span");p.innerHTML=" "+o[d],i.id="Filter"+t+"Ctrl"+d,i.value=o[d],i.setAttribute("data-layerId",L.stamp(e)),i.setAttribute("data-field",t),i.setAttribute("data-layername",a),l.appendChild(i),l.appendChild(p),ul.appendChild(l),this._layers[s].subfiltercontrols.push({id:i.id,type:"accordioncheckbox",field:t}),L.DomEvent.addListener(i,"change",L.DomEvent.stopPropagation).addListener(i,"change",L.DomEvent.preventDefault).addListener(i,"change",this._onCheckBoxFilter,this)}return r.appendChild(ul),r},_CheckBoxFilter:function(e,t,a,r){if(e.feature.properties[t]){var i=document.getElementById(a);i.checked?i.value==e.feature.properties[t]&&(e._icon.style.display="",this._subfilter(e,r,this)):i.value==e.feature.properties[t]&&(e._icon.style.display="none")}},_onCheckBoxFilter:function(e){this._handlingClick=!0;var t=e.currentTarget,a=e.currentTarget.getAttribute("data-layerid"),r=e.currentTarget.getAttribute("data-field"),i=e.currentTarget.getAttribute("data-layername"),l=this.unset(this._layers[a].subfiltercontrols,t.id);for(ml in this._map._layers)this._map._layers[ml].feature&&this._map._layers[ml].options.title.toLowerCase()==i.toLowerCase()&&this._CheckBoxFilter(this._map._layers[ml],r,t.id,l)},_RadioFilter:function(e,t,a,r){var i=[],l=[];if(e.feature.properties[t]){var n=document.getElementById(a),s="";for(index in n.childNodes)if(n.childNodes[index].childNodes[0].checked){s=n.childNodes[index].childNodes[0].value;break}"all"==s.toLowerCase()?(i.push(e),l.push(JSON.stringify(e.toGeoJSON())),e._icon.style.display="",this._subfilter(e,r,this)):e.feature.properties[t].toLowerCase()==s.toLowerCase()?(i.push(e),l.push(JSON.stringify(e.toGeoJSON())),e._icon.style.display="",this._subfilter(e,r,this)):e._icon.style.display="none"}},_onRadioFilter:function(e){this._handlingClick=!0;var t=e.currentTarget,a=e.currentTarget.getAttribute("data-layerid"),r=this.unset(this._layers[a].subfiltercontrols,t.id);for(ml in this._map._layers)this._map._layers[ml].feature&&this._map._layers[ml].options.title&&this._map._layers[ml].options.title.toLowerCase()==t.parentElement.id.toLowerCase()&&this._RadioFilter(this._map._layers[ml],t.id.substring(11),t.id,r)},_DropDownFilter:function(e,t,a,r){if(e.feature.properties[t]){var i=document.getElementById(a);"all"==i.value.toLowerCase()?(e._icon.style.display="",that._subfilter(e,r,that)):e.feature.properties[t].toLowerCase()==i.value.toLowerCase()?e._icon.style.display="":e._icon.style.display="none"}},_onDropDownFilter:function(e){this._handlingClick=!0;var t=e.currentTarget,a=e.currentTarget.getAttribute("data-layerid"),r=e.currentTarget.getAttribute("data-field"),i=this.unset(this._layers[a].subfiltercontrols,t.id),l=this;$.each(this._map._layers,function(e){var a=this._map._layers[e];a.feature&&a.options.title.toLowerCase()==t.parentElement.id.toLowerCase()&&a.feature.properties[r]&&("all"==t.value.toLowerCase()?(a._icon.style.display="",l._subfilter(a,i,l)):a.feature.properties[r].toLowerCase()==t.value.toLowerCase()?(a._icon.style.display="",l._subfilter(a,i,l)):a._icon.style.display="none")}),this._handlingClick=!1},_onMarkerChange:function(e){this._handlingClick=!0;for(var t in e.currentTarget)if(e.currentTarget[t].selected){var a=e.currentTarget[t].getAttribute("data-lat"),r=e.currentTarget[t].getAttribute("data-lon");this._map.panTo(new L.LatLng(a,r));break}this._handlingClick=!1},_addItem:function(e){var t,a,r="leaflet-panel-layers",i=e.overlay?this._overlaysList:this._baseLayersList;if(e.group){if(!this._groups[e.group]){this._groups[e.group]=L.DomUtil.create("fieldset",r+"-group",i),t=L.DomUtil.create("legend",r+"-grouplabel");var l=document.createElement("span");l.innerHTML=" "+e.group,this._groups[e.group].id=e.group,t.appendChild(l),this._groups[e.group].appendChild(t)}i=this._groups[e.group],t=this._createItem(e),i.appendChild(t)}else t=this._createItem(e),i.appendChild(t);if(e.layer){if(e.group){if(!this._groups[e.group]){var n=e.name;e.displayname&&(n=e.displayname),this._groups[e.group]=L.DomUtil.create("fieldset",r+"-group",i),this._groups[e.group].name=e.name,t=L.DomUtil.create("legend",r+"-grouplabel");var l=document.createElement("span");l.innerHTML=" "+n,t.appendChild(l),this._groups[e.group].appendChild(t)}i=this._groups[e.group]}a=e.layer.active,void 0==a&&(a=!1);var s=this;if(e.IsActiveMarker)if(e.markertype)if("dropdown"==e.markertype.toLowerCase()){var o=s._createMarkerDropDown(e);i.appendChild(o)}else if("accordion"==e.markertype.toLowerCase()){var d=s._createMarkerAccordion(e);i.appendChild(d)}else if("accordioncheckbox"==e.markertype.toLowerCase()){var d=s._createMarkerAccordionCheckbox(e);i.appendChild(d)}else if("button"==e.markertype.toLowerCase()){var c=L.stamp(e.layer);Object.keys(e.layer._layers).forEach(function(a){e.layer._layers[a].feature&&(t=s._createMarkerItem(e.layer._layers[a],c),i.appendChild(t))})}else{var c=L.stamp(e.layer);Object.keys(e.layer._layers).forEach(function(a){e.layer._layers[a].feature&&(t=s._createMarkerItem(e.layer._layers[a],c),i.appendChild(t))})}else{var c=L.stamp(e.layer);Object.keys(e.layer._layers).forEach(function(a){e.layer._layers[a].feature&&(t=s._createMarkerItem(e.layer._layers[a],c),i.appendChild(t))})}if(e.filter)for(var p in e.filter){var o=this.addFilterItem(e,p);i.appendChild(o)}}return t},addFilterItem:function(e,t){var a;if(e.filter[t].type)switch(e.filter[t].type.toLowerCase()){case"dropdown":a=this._createFilterDropDown(e.layer,e.filter[t].field,e.name);break;case"checkbox":a=this._createFilterCheckBox(e.layer,e.filter[t].field,e.name);break;case"radio":a=this._createFilterRadio(e.layer,e.filter[t].field,e.name);break;case"accordioncheckbox":var a=this._createFilterAccordionCheckBox(e.layer,e.filter[t].field,e.name)}return a},_onbaselayersInputClick:function(e){var t,a,r,i,l=this._baseLayersCtrl.length;for(this._handlingClick=!0,t=0;l>t;t++)a=document.getElementById(this._baseLayersCtrl[t].id),i=a.getAttribute("data-layerid"),r=this._layers[i],a.checked&&!this._map.hasLayer(r.layer)?this._map.addLayer(r.layer):!a.checked&&this._map.hasLayer(r.layer)&&this._map.removeLayer(r.layer);this._handlingClick=!1,this._refocusOnMap()},_onInputClick:function(e){var t,a,t=e.currentTarget,r=e.currentTarget.getAttribute("data-layerid");if(this._handlingClick=!0,a=this._layers[r])if(t.checked&&!this._map.hasLayer(a.layer)){for(k in a.subcontrols){var i=document.getElementById(a.subcontrols[k].id);switch(a.subcontrols[k].type){case"accordion_li":i.style.pointerEvents="auto";break;case"dropdown":i.disabled=!1;break;case"label":i.disabled=!1,L.DomEvent.addListener(i,"click",L.DomEvent.stopPropagation).addListener(i,"click",L.DomEvent.preventDefault).addListener(i,"click",this._onMarkerClick,this)}}for(s in a.subfiltercontrols){var l=document.getElementById(a.subfiltercontrols[s].id);switch(a.subfiltercontrols[s].type){case"checkbox":l.disabled=!1;break;case"dropdown":l.disabled=!1;break;case"radio":l.disabled=!1,L.DomEvent.addListener(l,"click",L.DomEvent.stopPropagation).addListener(l,"click",L.DomEvent.preventDefault).addListener(l,"click",this._onRadioFilter,this)}}this._map.addLayer(a.layer)}else if(!t.checked&&this._map.hasLayer(a.layer)){this._map.removeLayer(a.layer);for(k in a.subcontrols){var i=document.getElementById(a.subcontrols[k].id);switch(a.subcontrols[k].type){case"accordion_li":i.style.pointerEvents="none";break;case"dropdown":i.disabled=!0;break;case"label":L.DomEvent.removeListener(i,"click",L.DomEvent.stopPropagation).removeListener(i,"click",L.DomEvent.preventDefault).removeListener(i,"click",this._onMarkerClick,this)}}for(s in a.subfiltercontrols){var l=document.getElementById(a.subfiltercontrols[s].id);switch(a.subfiltercontrols[s].type){case"checkbox":l.disabled=!0;break;case"dropdown":l.disabled=!0;break;case"radio":l.disabled=!0,L.DomEvent.removeListener(l,"click",L.DomEvent.stopPropagation).removeListener(l,"click",L.DomEvent.preventDefault).removeListener(l,"click",this._onRadioFilter,this)}}}this._handlingClick=!1,this._refocusOnMap()},_onMarkerClick:function(e){this._handlingClick=!0;var t=e.currentTarget.getAttribute("data-lat"),a=e.currentTarget.getAttribute("data-lon"),r=e.currentTarget.getAttribute("data-layerid"),i=this._layers[r],l="<p> "+e.currentTarget.innerText+"</p>",n=e.currentTarget.getAttribute("data-markerid");this._map.flyTo(new L.LatLng(t,a),15);for(ml in this._map._layers){var s=this._map._layers[ml];if(s.feature&&s.options.title.toLowerCase()==i.name.toLowerCase()){if(s._leaflet_id==n){s._icon.src="images/select-marker.png",s._icon.style.cursor="#08f",popup=new L.Popup;var o=(this._map.getBounds(),parseFloat(t)+.0012);popup.setLatLng(new L.LatLng(o,a)),popup.setContent(l),this._map.openPopup(popup),s.fire("click")}s.closePopup()}}return this._handlingClick=!1,s},_subfilter:function(e,t,a){t&&t.length>0&&$.each(t,function(r){switch(t[r].type){case"radio":a._RadioFilter(e,t[r].field,t[r].id);break;case"checkbox":a._CheckBoxFilter(e,t[r].field,t[r].id);break;case"dropdown":a._DropDownFilter(e,t[r].field,t[r].id)}})},_initLayout:function(){var e="leaflet-panel-layers",t=this._container=L.DomUtil.create("div",e);t.setAttribute("aria-haspopup",!0),t.style.height=this._map.getSize().y+"px",this._map.on("resize",function(e){t.style.height=e.newSize.y+"px"});var a=this._form=L.DomUtil.create("form",e+"-list");if(this.options.collapsed){L.Browser.android||L.DomEvent.on(t,"mouseover",this._expand,this).on(t,"mouseout",this._collapse,this);var r=this._layersLink=L.DomUtil.create("a",e+"-toggle",t);r.href="#",r.title="Layers",L.Browser.touch?L.DomEvent.on(r,"click",L.DomEvent.stop).on(r,"click",this._expand,this):L.DomEvent.on(r,"focus",this._expand,this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=L.DomUtil.create("div",e+"-base",a),this._separator=L.DomUtil.create("div",e+"-separator",a),this._overlaysList=L.DomUtil.create("div",e+"-overlays",a),t.appendChild(a)},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-panel-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-panel-layers-expanded","")},_getPath:function(e,t){var a=t.split("."),r=a.pop(),i=a.length,l=a[0],n=1;if(i>0)for(;(e=e[l])&&i>n;)l=a[n++];return e?e[r]:void 0},unset:function(e,t){var a=[],r=this;return $.each(e,function(i){e[i].id!=t&&r.stringStartWith(e[i].id,"Filter")&&a.push(e[i])}),a},stringStartWith:function(e,t){return e.slice(0,t.length)==t}}),L.Control.panelLayers=function(e,t,a){return console.log("panelLayers"),new L.Control.PanelLayers(e,t,a)}}).call(this);